<!doctype html>
<html lang="pt-br">

	<head>
		<meta charset="utf-8">

		<title>Curso - Primeiros passos com Ansible - Code Prestige</title>

		<meta name="description" content="Curso de Introdução ao Ansible da Code Prestige">
		<meta name="author" content="Romulo Scampini">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css" id="theme">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Custom CSS -->
		<link rel="stylesheet" href="css/custom.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section data-background="images/ansible-background-3.jpg">
					<h1>Primeiros passos com ansible</h1>
					<h4>Curso introdutório a ferramenta Ansible</h3>
					<p>
						<small>
							Instrutor: <a href="http://scampini.com.br"> Romulo Scampini</a>
						</small>
					</p>
					<p>
						<small>
							Realização: <a href="http://www.codeprestige.com.br" target="_blank" class="cp-link">Code Prestige</a>&nbsp;&nbsp;&nbsp;
							Apoio: <a href="http://www.imasters.com.br" target="_blank" class="cp-link">iMasters</a>
						</small>
					</p>
				</section>

				<section data-background="images/fundo-codeprestige.jpg" class="without-border">
					<!-- <h2>Code Prestige</h2> -->
					<img height="200" data-src="images/logo-branco.png">
					<p>
						A Code Prestige é uma escola especializada no ensino de programação. Desenvolvemos diariamente artigos, cursos, livros digitais, vídeos e outros conteúdos que já auxiliaram mais de 4000 pessoas de todo o Brasil a alcançarem seus objetivos profissionais.
					</p>
					<p><small>Visite o nosso site e nos siga nas redes sociais!</small></p>
				</section>

				<section>
                    <h2>Instrutor</h2>
                    <div id="left">
                        <img data-src="https://avatars2.githubusercontent.com/u/4999289" />
                    </div>
                    <div id="right">
                        <ul>
                            <li><b>Nome:</b> Romulo Scampini</li>
                            <li><b>Idade:</b> 27 anos</li>
                            <li><b>Minibio:</b> Cofundador da CodePrestige, atua com Desenvolvimento/DevOps, palestrante em eventos e eterno estudante.</li>
                        </ul>
                    </div>
                </section>

                <section>
                    <h2>Requisitos</h2>
                    <ul>
                        <li><a href="https://www.python.org/downloads" target="_blank">Python (versão >= 2.7)</a></li>
                        <li><a href="http://docs.ansible.com/ansible/latest/intro_installation.html#installing-the-control-machine" target="_blank">Ansible (última versão - LTS)</a></li>
                        <li>Editor de texto</li>
                    </ul>
                    <p>Ou </p>
                    <p><a href="https://1drv.ms/u/s!AsA38lgui-DqoIp-HN52aV8bkWfxwQ">* VM do Ubuntu já com Ansible, Python e Visual Studio Code instalados</a></p>
                </section>

				<section>
                    <section>
                        <h2>Antes de começar...</h2>
                        <ul>
                            <li>Problema</li>
                            <li>Propostas de solução</li>
                            <li>Estrutura do ansible</li>
                            <li>Ansible</li>
                        </ul>
                    </section>
                    <section>
						<h2>Problema</h2>
						<ul>
							<li>Tarefas e configurações de Infra (Ops) <span class="fragment highlight-blue">manuais</span></li>
							<li>Automação existente era com <span class="fragment highlight-blue">shell script</span></li>
							<li>Cenário antes das ferramentas de automação</li>
						</ul>
					</section>
					<section>
						<img data-src="images/pre-ansible.gif" />
					</section>
				</section>

				<section>
					<section>
						<h1>Qual a solução ?</h1>
						<h2><span class="fragment highlight-blue"> Ansible</span></h2>
					</section>

					<section>
						<h1>O que é?</h1>
						<p>Uma ferramenta open-source para automatizar tarefas relacionadas à infraestrutura.</p>
						<h3>Base:</h3>
						<ul>
							<li>Estrutura interna do Ansible</li>
							<li>Estrutura básica de um do projeto</li>
						</ul>
					</section>
				</section>

				<section>
					<section>
						<h2>Estrutura interna do Ansible</h2>
					</section>
					<section>
						<h3>Estrutura interna do Ansible</h2>
						<ul>
							<li>Escrito em Python</li>
							<li>Versão Atual - 2.4</li>
                            <li>Módulos
                                <ul>
                                    <li>Python</li>
                                </ul>
                            </li>
							<li>Templates
								<ul>
									<li>jinja2</li>
								</ul>			
							</li>
							<li><a href="http://bit.ly/ansible-yaml" target="_blank">YAML</a></li>
							<li>Conexão via ssh (*ou local)</li>
						</ul>
					</section>

					<section>
						<h2>Estrutura básica de um do projeto</h2>
					</section>	
					<section>
						<img data-src="images/ansible-estrutua-basica.png" />
					</section>
				</section>

				<section>
					<section>
						<h1>Ansible &#10084; YAML</h1>
					</section>
					<section>
						<h2>Variáveis</h2>
						<ul>
							<li>Não é necessário especificar o tipo</li>
							<pre><code class="hljson">nome_var: valor</code></pre>
							<li>Tipos: String, Int, Boolean, etc</li>
							<li>YAML também suporta dicionário (Mapa)</li>
							<pre><code class="hljson">
informacoes_db:
	host: 172.17.0.1
	port: 5432
	db: nome_db
	username: usuario_db
	password: 123456
</code></pre>
							<li>Como utilizar a variável ?</li>
							<li>Próximo slide, hehe.</li>
						</ul>
					</section>
					<section>
						<h2>Utilização das variáveis</h2>
                        <ul>
                            <li>Variável simples:</li>
<pre><code class="hljson">usuario: codeprestige
grupo: "{{ usuario }}"
</code></pre>
                            <li>Um mapa:</li>
                            <pre><code class="hljson">informacoes_db:
  host: 172.17.0.1
  port: 5432
  db: nome_db
  username: usuario_db
  password: 123456
                                    </code></pre>
<pre><code>db_port: "{{ informacoes_db.port }}"       OU
db_port: "{{ informacoes_db['port'] }}"</code></pre>
                        </ul>
                    </section>
                    <section>
                        <ul>
                            <li>Array:</li>
                            <pre><code class="hljson">usuarios: [ ]</code></pre>
                            <pre><code class="hljson">grupo:
  - codeprestige
  - imasters</code></pre>
                            <li>Variável com valor default:</li>
                            <pre><code class="hljson">usuarios: "{{ user_cp|default('root') }}"</code></pre>
                            <li>Variável boolean:</li>
                            <pre><code class="hljson">usuario_sudo: True</code></pre>
                            </ul>
                    </section>
				</section>

                <section>
                    <section>
                        <h1>Módulo</h1>
                    </section>
                    <section>
                        <h2>Módulo</h2>
                        <ul>
                            <li>É o que irá realizar a tarefa</li>
                            <li>É o que permite e facilita a execução de tarefas</li>
                            <li>Uma das maiores vantagens do ansible, e a quantidade de módulos já prontos</li>
                        </ul>
                    </section>
                    <section>
                        <h1>Playbook's</h1>
                    </section>
                    <section>
                        <h2>Playbook's</h2>
                        <ul>
                            <li>Declaração de tarefas a serem executadas.</li>
                            <li>É a "receita" do que fazer.</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Playbook's</h2>
                        <pre>
                            <code class="hljson">---
 - hosts: all
   tasks:

     - name: create folder
       file:
         path: /tmp/codeprestige-ansible
         state: directory

     - name: copy file
       copy:
         src: /etc/hosts
         dest: /tmp/codeprestige-ansible/hosts</code></pre>
                    </section>
                </section>

				<section>
					<section><h1>Exercício 1</h1></section>
					<section>
						<h2>Objetivo</h2>
						<p>Criar um projeto ansible para criar uma pasta e copiar o arquivo /etc/hosts para a pasta criada</p>
					</section>
					<section>
						<ol>
							<li>Criar os arquivos básicos para um projeto ansible
                                <ul>
                                    <li>ansible.cfg</li>
                                    <li>inventory</li>
                                    <li>run-ansible.sh</li>
                                </ul>
                            </li>
							<li>Criar um playbook para executar as tarefas</li>
							<li>Configurar as tarefas no playbook</li>
							<li>Executar o playbook e conferir o resultado</li>
						</ol>
					</section>

                    <section>
                        <h2>Resumo</h2>
                        <p>Estrutura de arquivos base:</p>
                        <ul>
                            <li>Ansible.cfg
                                <ul>
                                    <li>Arquivo com configurações do ansible</li>
                                </ul>
                            </li>
                            <li>Inventory
                                <ul>
                                    <li>Determina em e quais máquinas serão instalados/configurados os itens do playbook.</li>
                                </ul>
                            </li>
                            <li>run-ansible.sh</li>
                        </ul>
                    </section>

                </section>

				<section>
                    <section>
                        <h1>Templates</h1>
                    </section>

					<section>
						<h2>Templates</h2>
						<ul>
                            <li>Permite a customização e criação de arquivos com conteúdo dinâmico.</li>
                            <li>Por ex, um arquivo de configuração do postgres (pg_hba.conf), onde o IP liberado para acesso ao banco varia de acordo com o ambiente (Produção, Homolog, etc).</li>
                        </ul>
					</section>

                    <section>
                        <p>Exemplo de arquivo template</p>
                        <img data-src="images/ansible-template.png" />
                    </section>

                    <section>
                       <p>Utiliza outra task para copiar o template.</p>
                        <img data-src="images/ansible-template-example.png" />
                    </section>
				</section>

                <section>
                    <section>
                        <h1>Roles</h1>
                    </section>

                    <section>
                        <h2>Roles</h2>
                        <p>Conjunto de tarefas e/ou variáveis comuns</p>
                    </section>

                    <section>
                        <h2>Estrutura de Role</h2>
                        <img data-src="images/ansible-role-example.png" />
                    </section>
                </section>

                <section>
                    <section>
                        <h1>Hierarquia</h1>
                    </section>

                    <section>
                        <h2>Hierarquia do projeto</h2>
                        <ol>
                            <li>roles</li>
                            <li>group_vars</li>
                            <li>host_vars</li>
                            <li>playbook.yml</li>
                            <li>tempo de execução</li>
                        </ol>
                    </section>
                </section>

                <section>
                    <section>
                        <h1>Exercício 2</h1>
                    </section>
                    <section>
                        <h2>Objetivo</h2>
                        <p>Criar um projeto ansible com role para instalar o VirtualBox e o Vagrant</p>
                    </section>
                    <section>
                        <ul>
                            <li>Criar um projeto com a estrutura básica</li>
                            <li>Criar a role com a estrutura básica</li>
                            <li>Definir as tarefas para cada tipo de S.O.</li>
                            <li>Incluir condição para chamar as tasks referente ao S.O. correto</li>
                            <li>Incluir no playbook a chamada da role</li>
                        </ul>
                    </section>
                </section>

				<section>
					<section>
						<h1>Projeto Final</h1>
					</section>
                    <section>
                        <h2>Objetivo</h2>
                        <p>Instalar o nginx no Ubuntu e copiar uma página index.html para ser exibida</p>
                    </section>
                    <section>
                        <h2>Prazo</h2>
                        <p>1 Semana</p>
                    </section>
                    <section>
                        <h3>Requisitos</h3>
                        <ul>
                            <li>Verificar se o S.O. é Ubuntu antes de iniciar a instalação</li>
                            <li>Copiar o arquivo index.html para o DocumentRoot do nginx</li>
                            <li>O index.html deve ter uma variável, e a mesma deve ser definida no projeto (Em qualquer nível)</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Desafio</h2>
                        <p>Criar uma role que faça essa instalação, e preparar a instalação para CentOS também.
                            A própria role deve identificar qual o instalação deve realizar de acordo com S.O.</p>
                    </section>
					<section>
						<h2>Entrega</h2>
						<p>A entrega deve ser feita nesta <a href="https://github.com/codeprestige/curso-primeirospassosansible/issues/1" target="_blank">issue</a> do projeto no GitHub</p>
                    </section>
                </section>

                <section style="text-align: left;">
                    <h1>Referências</h1>
                    <p>
                        - <a href="https://www.ansible.com/" target="_blank">Ansible: Página oficial</a> <br>
                        - <a href="http://docs.ansible.com/ansible/latest/index.html" target="_blank">Ansible: Documentação Oficial</a> <br>
                        - <a href="https://github.com/ansible/ansible">GitHub: Ansible</a> <br>
                    </p>
                </section>

                <section data-background="images/fundo-codeprestige.jpg" class="without-border">
                    <a>
                        <img height="200" data-src="images/logo-branco.png">
                    </a>
                </section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/search/search.js', async: true },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
